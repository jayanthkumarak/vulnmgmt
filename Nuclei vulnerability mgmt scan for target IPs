#!/bin/bash

# Check if prips is installed; if not, install it
if ! command -v prips &> /dev/null; then
    echo "prips not found, installing..."
    sudo apt-get update && sudo apt-get install -y prips
fi

# Function to generate target list for /24 subnet using prips
generate_targets_24() {
  local base_ip="$1"
  # Generate IPs in the range base_ip.0 to base_ip.254 using prips
  prips "${base_ip}.0" "${base_ip}.254" > targets.txt
}

# Function to generate target list for /17 subnet using prips
generate_targets_17() {
  local base_ip="$1"
  # Generate IPs in the range base_ip.0.0 to base_ip.127.255 using prips
  prips "${base_ip}.0.0" "${base_ip}.127.255" > targets.txt
}

# Prompt user for IP subnet and template path
read -p "Enter IP subnet (e.g., 10.7.1.0/24 or 10.7.0.0/17): " IP_SUBNET
read -p "Enter path to Nuclei templates: " TEMPLATE_PATH

# Determine subnet type and base IP
subnet_type="${IP_SUBNET#*/}"
base_ip="${IP_SUBNET%/*}"

# Check if input subnet is valid
if ! [[ "$subnet_type" =~ ^(24|17)$ ]]; then
  echo "Invalid subnet type. Must be 24 or 17."
  exit 1
fi

# Check if template path exists
if ! [[ -d "$TEMPLATE_PATH" ]]; then
  echo "Template path does not exist."
  exit 1
fi

# Choose appropriate function based on subnet type
case "$subnet_type" in
  24) generate_targets_24 "$base_ip";;
  17) generate_targets_17 "$base_ip";;
  *) echo "Unsupported subnet type"; exit 1;;
esac

# Run Nuclei scan with generated target list
nuclei -l targets.txt -t "$TEMPLATE_PATH"

# Cleanup
rm targets.txt
