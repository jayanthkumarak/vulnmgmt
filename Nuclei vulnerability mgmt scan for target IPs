#!/bin/bash

# Check if prips is installed
if ! command -v prips &> /dev/null; then
  # If prips is not installed, install it
  if [ "$(sudo apt-get install -y prips 2>/dev/null)" ]; then
    # prips installed successfully, continue
    echo "prips installed"
  else
    # prips installation failed, exit 1
    echo "prips installation failed"
    exit 1
  fi
fi

# Generate targets for Nuclei scan
generate_targets() {
  local base_ip="$1"
  local subnet_type="$2"

  # Generate IP addresses in the subnet
  case "$subnet_type" in
    24)
      prips "${base_ip}.0" "${base_ip}.254"
    ;;
    17)
      prips "${base_ip}.0.0" "${base_ip}.127.255"
    ;;
    *)
      echo "Invalid subnet type"
      exit 1
    ;;
  esac
}

# Prompt user for IP subnet and template path
read -p "Enter IP subnet (e.g., 10.7.1.0/24 or 10.7.0.0/17): " IP_SUBNET
read -p "Enter path to Nuclei templates: " TEMPLATE_PATH

# Determine subnet type and base IP
subnet_type="${IP_SUBNET#*/}"
base_ip="${IP_SUBNET%/*}"

# Check if input subnet is valid
if ! [[ "$subnet_type" =~ ^(24|17)$ ]]; then
  echo "Invalid subnet type. Must be 24 or 17."
  exit 1
fi

# Check if template path exists
if ! [[ -d "$TEMPLATE_PATH" ]]; then
  echo "Template path does not exist."
  exit 1
fi

# Generate targets for Nuclei scan
generate_targets "$base_ip" "$subnet_type"

# Run Nuclei scan with generated target list
nuclei -l targets.txt -t "$TEMPLATE_PATH"

# Cleanup
rm targets.txt
